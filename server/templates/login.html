<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; script-src 'self' 'unsafe-inline';">
<title>Encore License Server ‚Äî Login</title>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg: #0a0e17;
  --surface: #111827;
  --surface-2: #1a2235;
  --border: #2a3550;
  --border-glow: rgba(99, 145, 255, 0.2);
  --text: #e2e8f0;
  --text-dim: #7a8ba8;
  --text-muted: #4a5a78;
  --accent: #6391ff;
  --accent-glow: rgba(99, 145, 255, 0.35);
  --green: #34d399;
  --red: #f87171;
  --red-dim: rgba(248, 113, 113, 0.15);
  --purple: #a78bfa;
  --radius: 12px;
  --radius-sm: 8px;
  --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-spring: 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
  --shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
  --shadow-lg: 0 8px 40px rgba(0, 0, 0, 0.4);
}

html { font-size: 14px; }
body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  display: grid;
  place-items: center;
  overflow: hidden;
}

body::before {
  content: '';
  position: fixed;
  inset: 0;
  background:
    radial-gradient(ellipse 80% 60% at 20% 20%, rgba(99, 145, 255, 0.06), transparent),
    radial-gradient(ellipse 60% 80% at 80% 80%, rgba(167, 139, 250, 0.04), transparent);
  pointer-events: none;
  z-index: 0;
}

.login-card {
  position: relative;
  z-index: 1;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 40px 36px;
  width: 100%;
  max-width: 400px;
  box-shadow: var(--shadow-lg);
  animation: fadeSlideUp 0.6s var(--transition) both;
}

.login-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--accent), var(--purple));
  border-radius: var(--radius) var(--radius) 0 0;
}

.logo-wrap {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 14px;
  margin-bottom: 32px;
}

.logo {
  width: 48px; height: 48px;
  background: linear-gradient(135deg, var(--accent), var(--purple));
  border-radius: 12px;
  display: grid; place-items: center;
  font-size: 24px; font-weight: 700; color: white;
  box-shadow: 0 4px 16px var(--accent-glow);
}

.logo-text h1 {
  font-size: 1.3rem;
  font-weight: 700;
  letter-spacing: -0.02em;
}
.logo-text h1 span { color: var(--accent); }
.logo-text p {
  font-size: 0.75rem;
  color: var(--text-muted);
  margin-top: 2px;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--text-dim);
  margin-bottom: 8px;
  text-transform: uppercase;
  letter-spacing: 0.04em;
}

.input-wrap {
  position: relative;
}

.input-wrap input {
  width: 100%;
  padding: 12px 16px;
  padding-right: 44px;
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  background: var(--surface-2);
  color: var(--text);
  font-size: 0.9rem;
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  outline: none;
  transition: var(--transition);
  letter-spacing: 0.05em;
}

.input-wrap input::placeholder {
  color: var(--text-muted);
  font-family: 'Inter', system-ui, sans-serif;
  letter-spacing: normal;
}

.input-wrap input:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-glow);
}

.input-wrap .toggle-vis {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: var(--text-muted);
  cursor: pointer;
  padding: 4px 8px;
  font-size: 1.1rem;
  transition: var(--transition);
  border-radius: 4px;
}
.input-wrap .toggle-vis:hover { color: var(--text); background: rgba(255,255,255,0.05); }

.error-msg {
  display: none;
  padding: 10px 14px;
  border-radius: var(--radius-sm);
  background: var(--red-dim);
  color: var(--red);
  font-size: 0.82rem;
  font-weight: 500;
  margin-bottom: 16px;
  animation: shake 0.4s ease;
  align-items: center;
  gap: 8px;
}
.error-msg.visible { display: flex; }

.btn-login {
  width: 100%;
  padding: 13px 20px;
  border: none;
  border-radius: var(--radius-sm);
  background: linear-gradient(135deg, var(--accent), var(--purple));
  color: white;
  font-size: 0.9rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  position: relative;
  overflow: hidden;
}
.btn-login:hover {
  box-shadow: 0 4px 20px var(--accent-glow);
  transform: translateY(-1px);
}
.btn-login:active { transform: translateY(0) scale(0.98); }
.btn-login:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

.btn-login .spinner {
  display: none;
  width: 16px; height: 16px;
  border: 2px solid transparent;
  border-top-color: white;
  border-radius: 50%;
  animation: spin 0.6s linear infinite;
  margin-right: 8px;
}
.btn-login.loading .spinner { display: inline-block; }
.btn-login.loading .btn-text { opacity: 0.7; }

.footer {
  text-align: center;
  margin-top: 24px;
  font-size: 0.75rem;
  color: var(--text-muted);
}
.footer a { color: var(--accent); text-decoration: none; }
.footer a:hover { text-decoration: underline; }

@keyframes fadeSlideUp {
  from { opacity: 0; transform: translateY(24px); }
  to { opacity: 1; transform: translateY(0); }
}
@keyframes shake {
  0%, 100% { transform: translateX(0); }
  20% { transform: translateX(-6px); }
  40% { transform: translateX(6px); }
  60% { transform: translateX(-4px); }
  80% { transform: translateX(4px); }
}
@keyframes spin { to { transform: rotate(360deg); } }

@media (max-width: 480px) {
  .login-card { margin: 16px; padding: 28px 24px; }
}
</style>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>

<div class="login-card">
  <div class="logo-wrap">
    <div class="logo">E</div>
    <div class="logo-text">
      <h1>Encore <span>License Server</span></h1>
      <p>Admin Authentication Required</p>
    </div>
  </div>

  <div class="error-msg" id="errorMsg">
    <span>‚úï</span>
    <span id="errorText">Invalid API key</span>
  </div>

  <form id="loginForm" autocomplete="off">
    <div class="form-group">
      <label for="apiKey">API Key</label>
      <div class="input-wrap">
        <input
          type="password"
          id="apiKey"
          name="apiKey"
          placeholder="Enter your API key"
          autocomplete="off"
          spellcheck="false"
          required
        >
        <button type="button" class="toggle-vis" onclick="toggleVisibility(this)" title="Show password">üëÅ</button>
      </div>
    </div>
    <button type="submit" class="btn-login" id="loginBtn">
      <span class="spinner"></span>
      <span class="btn-text">Sign In</span>
    </button>
  </form>

  <div class="footer">
    <p>Secured with session-based authentication</p>
  </div>
</div>

<script>
const form = document.getElementById('loginForm');
const input = document.getElementById('apiKey');
const btn = document.getElementById('loginBtn');
const errorMsg = document.getElementById('errorMsg');
const errorText = document.getElementById('errorText');

// Focus input on load
input.focus();

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const key = input.value.trim();
  if (!key) return;

  btn.disabled = true;
  btn.classList.add('loading');
  errorMsg.classList.remove('visible');

  try {
    const r = await fetch('/api/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ api_key: key }),
    });

    if (r.ok) {
      // Success ‚Äî redirect to dashboard
      window.location.href = '/';
    } else {
      const d = await r.json().catch(() => ({}));
      errorText.textContent = d.error || 'Authentication failed';
      errorMsg.classList.add('visible');
      input.select();
    }
  } catch (err) {
    errorText.textContent = 'Network error ‚Äî is the server running?';
    errorMsg.classList.add('visible');
  } finally {
    btn.disabled = false;
    btn.classList.remove('loading');
  }
});

function toggleVisibility(btn) {
  const inp = document.getElementById('apiKey');
  if (inp.type === 'password') {
    inp.type = 'text';
    btn.textContent = '‚úï'; // Visual indicator to hide
    btn.title = 'Hide password';
  } else {
    inp.type = 'password';
    btn.textContent = 'üëÅ';
    btn.title = 'Show password';
  }
}

// Enter key submits
input.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') form.dispatchEvent(new Event('submit'));
});
</script>

</body>
</html>
